let date=new Date,year=date.getFullYear(),month=date.getMonth();const dates=document.querySelector(".calendar-dates"),currdate=document.querySelector(".calendar-current-date"),prenexIcons=document.querySelectorAll(".calendar-navigation span"),eventsDisplay=document.querySelector(".events"),months=["January","February","March","April","May","June","July","August","September","October","November","December"];function getCityIdFromURL(){const t=window.location.pathname,n=/\/cities\/(\d+)/,e=t.match(n);return e?e[1]:null}function getEventsOnDate(e,t){return e.filter(e=>{const n=new Date(e.start_date);n.setHours(0,0,0,0);const s=new Date(e.end_date);return s.setHours(0,0,0,0),t>=n&&t<=s})}function formatDateToDayAndHour(e){const t=new Date(e),n=t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${n} ${s}:${o}`}function getEventsOfDay(e){return eventsDisplay.querySelectorAll(`[data-day="${e}"]`)}function seeDay(){eventsDisplay.querySelectorAll(".day-events-detailed").forEach(e=>{e.style.display="none"});const e=getEventsOfDay(this.innerText);e.length>0?(e.forEach(e=>{e.style.display="block"}),eventsDisplay.style.display="block"):eventsDisplay.style.display="none";const t=document.querySelectorAll(".active");t&&t.forEach(e=>{e.classList.remove("active")}),this.classList.add("active")}function getEventElement(e,t){return`<div class="day-events-detailed" data-day=${e}>
                <h2 class="event-name">${t.name}</h2>
                <p class="event-dates">
                    <span class="start-date">${formatDateToDayAndHour(t.start_date)}</span> |
                    <span class="end-date">${formatDateToDayAndHour(t.end_date)}</span>
                </p>
                <p class="event-description">${t.description}</p>
            </div>`}async function updatecalendar(){let o=new Date(year,month,1).getDay(),n=new Date(year,month+1,0).getDate(),s=new Date(year,month,n).getDay(),i=new Date(year,month,0).getDate();try{const e=await fetch(`/api/cities/${getCityIdFromURL()}/events?year=${year}&month=${month}`),t=await e.json();events=t}catch{displayErr}let e="",t="";for(let t=o;t>0;t--)e+=`<li class="inactive">${i-t+1}</li>`;for(let s=1;s<=n;s++){let o=s===date.getDate()&&month===(new Date).getMonth()&&year===(new Date).getFullYear()?"today":"";day_events=getEventsOnDate(events,new Date(year,month,s)),e+=`
        <li class="day ${o}">${s}
            <div class="day-events">`;for(let n=0;n<Math.min(4,day_events.length);n++)e+=`<span class="event-indicator"></span>`,t+=getEventElement(s,day_events[n]);for(let e=4;e<day_events.length;e++)t+=getEventElement(s,day_events[e]);e+=`</div></li>`}for(let t=s;t<6;t++)e+=`<li class="inactive">${t-s+1}</li>`;currdate.innerText=`${months[month]} ${year}`,dates.innerHTML=e,eventsDisplay.innerHTML=t,dates.querySelectorAll(".day").forEach(e=>{e.addEventListener("click",seeDay)})}updatecalendar(),prenexIcons.forEach(e=>{e.addEventListener("click",()=>{month=e.id==="calendar-prev"?month-1:month+1,month<0||month>11?(date=new Date(year,month,(new Date).getDate()),year=date.getFullYear(),month=date.getMonth()):date=new Date,updatecalendar()})})