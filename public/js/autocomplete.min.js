const searchInput=document.getElementById("search-input"),suggestionsContainer=document.getElementById("suggestions");let currentController=null;searchInput.addEventListener("input",async function(){const e=searchInput.value;if(e.length<3){suggestionsContainer.innerHTML="",suggestionsContainer.classList.remove("has-content"),currentController&&currentController.abort();return}currentController&&currentController.abort(),currentController=new AbortController;const{signal:t}=currentController;Promise.all([fetch(`/api/questions?${encodeForAjax({query:e})}`,{signal:t})]).then(e=>Promise.all(e.map(e=>e.json()))).then(([e])=>{const t={questions:e};createSearchResultsHandler(t)}).catch(e=>{if(e.name==="AbortError")return;console.error("Error fetching data:",e),suggestionsContainer.innerHTML="";const t=document.createElement("div");t.classList.add("suggestion-item"),t.textContent="An error occurred. Please try again.",t.style.pointerEvents="none",suggestionsContainer.appendChild(t),suggestionsContainer.classList.add("has-content")})});function createSearchResultsHandler(e){if(suggestionsContainer.innerHTML="",e.questions.count===0){const e=document.createElement("li");e.classList.add("suggestion-item"),e.textContent="No suggestions found",e.style.pointerEvents="none",suggestionsContainer.appendChild(e),suggestionsContainer.classList.add("has-content");return}e.questions.count>5&&(e.questions.questions=e.questions.questions.slice(0,5));const t=document.createElement("li");t.classList.add("suggestion-header"),t.textContent="Questions suggested",suggestionsContainer.appendChild(t);function n(e){searchInput.value=e,suggestionsContainer.innerHTML="",suggestionsContainer.classList.remove("has-content")}e.questions.questions.forEach(e=>{const t=document.createElement("li");t.classList.add("suggestion-item"),t.textContent=e.title,t.role="option",t.tabIndex=0,t.addEventListener("click",function(){n(e.title)}),t.addEventListener("keydown",function(s){s.key==="Enter"?n(e.title):s.key==="ArrowDown"?(s.preventDefault(),suggestionsContainer.lastChild!==t&&document.activeElement.nextElementSibling.focus()):s.key==="ArrowUp"?(s.preventDefault(),suggestionsContainer.querySelector(":nth-child(2)")!==t&&document.activeElement.previousElementSibling.focus()):searchInput.focus()}),suggestionsContainer.appendChild(t)}),suggestionsContainer.classList.add("has-content"),searchInput.onkeydown=e=>{if(e.key!=="ArrowDown")return;e.preventDefault(),suggestionsContainer.querySelector(":nth-child(2)").focus()}}