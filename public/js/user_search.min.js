let isLoading=!1;const resultContainer=document.querySelector(".user-result");let debounceTimeout=null;const debounceTime=500;let page=1,maxPage=0;const previous=document.querySelector("#previous"),next=document.querySelector("#next"),resultsPerPage=10;previous.addEventListener("click",()=>{page>1&&page--,resetTimeout(updatePage)}),next.addEventListener("click",()=>{page<maxPage&&page++,resetTimeout(updatePage)}),document.querySelector("#search-user").addEventListener("input",()=>{resetTimeout(()=>{page=1,updatePage(document.querySelector("#search-user").value)})});function resetTimeout(e){clearTimeout(debounceTimeout),debounceTimeout=setTimeout(e,debounceTime)}function toggleLoaderState(){let e=document.querySelector(".loader");e&&(isLoading?e.style.display="block":e.style.display="none",resultContainer.appendChild(e))}function userSearchHandler(){let e=JSON.parse(this.responseText);if(this.status===200){let t=e.users;maxPage=Math.ceil(parseInt(e.count)/resultsPerPage),resultContainer.innerHTML=`<div class="loader"></div>`,t.forEach(e=>resultContainer.appendChild(createUser(e))),isLoading=!1,toggleLoaderState(),drawPagination()}else displayError(e.message)}function createUser(e){const t=document.createElement("a");return t.className="user-details",t.href=`/users/${e.id}`,t.innerHTML=`
        <div class="user-info">
            <p class="name">${escapeHtml(e.username)}</p>
            <p class="email">${escapeHtml(e.email)}</p>
            <p class="questions">${escapeHtml(e.questions)}</p>
            <p class="answers">${escapeHtml(e.answers)}</p>
        </div>
    `,t}function updatePage(e=""){isLoading=!0,resultContainer.innerHTML=`<div class="loader"></div>`,toggleLoaderState(),sendAjaxRequest("get","/api/users?"+encodeForAjax({query:e,page,limit:resultsPerPage}),{},userSearchHandler)}function createNumberNav(e,t){const n=document.createElement("a");return n.href="#",n.innerHTML=e.toString(),n.className="page-number",n.id=e.toString(),t&&n.classList.add("current"),n}function toggleButtonsVisibility(){page===1&&(previous.style.visibility="hidden"),page>=maxPage&&(next.style.visibility="hidden"),page<maxPage&&(next.style.visibility="visible"),page>1&&(previous.style.visibility="visible")}function drawPagination(){const e=document.querySelector(".pagination");e.innerHTML="",e.appendChild(createNumberNav(1,page===1)),page-3>1&&(e.innerHTML+=`<a>...</a>`);for(let t=Math.max(2,page-2);t<=Math.min(maxPage-1,page+2);t++)e.appendChild(createNumberNav(t,t===page));page+3<maxPage&&(e.innerHTML+=`<a>...</a>`),maxPage>1&&e.appendChild(createNumberNav(maxPage,page===maxPage)),toggleButtonsVisibility(),document.querySelectorAll(".page-number").forEach(e=>{e.addEventListener("click",async()=>{page=parseInt(e.id),updatePage()})})}updatePage();let add_user=document.getElementById("add-user");add_user.addEventListener("click",()=>{let e=document.getElementById("add-user-form");add_user.innerHTML==="person_add"?(add_user.innerHTML="close",e.style.display="block"):(add_user.innerHTML="person_add",e.style.display="none")})