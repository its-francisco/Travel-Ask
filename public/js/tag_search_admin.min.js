(()=>{let i=!1;const c=document.querySelector(".pagination-result");let h=null;const j=500;let e=1,t=0;const a=document.querySelector("#previous"),r=document.querySelector("#next"),m=20;a.addEventListener("click",()=>{e>1&&e--,o(n)}),r.addEventListener("click",()=>{e<t&&e++,o(n)});const d=document.querySelector("#search-tags");d.addEventListener("input",()=>{o(()=>{e=1,n(d.value)})});function o(e){clearTimeout(h),h=setTimeout(e,j)}function u(){const e=document.querySelector(".loader");i?e.style.display="block":e.style.display="none"}function p(){let n=JSON.parse(this.responseText);if(this.status===200){let s=n.tags;t=Math.ceil(parseInt(n.count)/m),c.innerHTML="",e==1&&s.length===0&&(c.innerHTML="<p>No tags found</p>"),Promise.all(s.map(e=>g(e))).then(e=>e.forEach(e=>c.appendChild(e))),i=!1,u(),_()}else displayError(n.message)}async function g(e){const t=document.createElement("li");t.setAttribute("data-id",e.id),t.innerHTML=`
        <a href='/search?query=%5B${escapeHtml(e.name)}%5D' class="tag"><p class="tag">${escapeHtml(e.name)}</p></a>
        <div class="confirmation">
            <button class="confirm-action delete-tag" title="delete-tag"> 
                <span class="material-symbols-outlined">delete</span>
            </button>
        </div>    `,t.className="tag-details";const n=t.querySelector(".delete-tag");return await setAsConfirmAction(n),n.addEventListener("click",v),t}function v(){const e=this.parentElement.parentElement.dataset.id;sendAjaxRequest("delete",`/api/tags/${e}`,{},b)}function b(){const e=JSON.parse(this.responseText);this.status===200?n():displayError(e.message)}function n(t=""){i=!0,u(),sendAjaxRequest("get","/api/tags?"+encodeForAjax({query:t,page:e,limit:m}),{},p)}function l(e,t){const n=document.createElement("a");return n.href="#",n.innerHTML=e.toString(),n.className="page-number",n.id=e.toString(),t&&n.classList.add("current"),n}function y(){e===1&&(a.style.visibility="hidden"),e>=t&&(r.style.visibility="hidden"),e<t&&(r.style.visibility="visible"),e>1&&(a.style.visibility="visible")}function _(){const s=document.querySelector(".pagination");s.innerHTML="",s.appendChild(l(1,e===1)),e-3>1&&(s.innerHTML+=`<a>...</a>`);for(let n=Math.max(2,e-2);n<=Math.min(t-1,e+2);n++)s.appendChild(l(n,n===e));e+3<t&&(s.innerHTML+=`<a>...</a>`),t>1&&s.appendChild(l(t,e===t)),y(),document.querySelectorAll(".page-number").forEach(t=>{t.addEventListener("click",async()=>{e=parseInt(t.id),n()})})}n();const s=document.getElementById("add-tag");s.addEventListener("click",()=>{const e=document.getElementById("add-tag-form");s.innerHTML==="new_label"?(s.innerHTML="close",e.style.display="block"):(s.innerHTML="new_label",e.style.display="none")});const f=document.getElementById("submit-tag"),w=f.parentElement.querySelector('input[type="text"]');f.addEventListener("click",e=>{e.preventDefault();const t=w.value;if(!t)return;sendAjaxRequest("post","/api/tags",{name:t},function(){let e=JSON.parse(this.responseText);if(this.status===200){n();const e=document.getElementById("tags-count"),t=parseInt(e.innerText.match(/(\d+)/)[0])+1;e.innerText=`Total tags: ${t}`}else displayError(e.message)})})})()